<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Lconnect by drkmsmithjr</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Lconnect</h1>
      <h2 class="project-tagline">LawnConnect - Raspberry Pi Controlled Lawn Lights</h2>
      <a href="https://github.com/drkmsmithjr/LConnect" class="btn">View on GitHub</a>
      <a href="https://github.com/drkmsmithjr/LConnect/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/drkmsmithjr/LConnect/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="lawnconnect" class="anchor" href="#lawnconnect" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://drkmsmithjr.github.io/LConnect">LawnConnect</a>
</h1>

<h3>
<a id="a-simple-raspberry-pi-powered-lawn-light-controller" class="anchor" href="#a-simple-raspberry-pi-powered-lawn-light-controller" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>A simple Raspberry Pi powered lawn light controller</h3>

<p>Never have dark outside lighting again!!!<br>
LawnConnect automatically controls and monitors your lawn lights and lets you know when something is wrong</p>

<p><a href="http://hackaday.com/2016/09/09/landscape-lighting-that-also-texts/"><img src="./HACKADAY.png" alt="alt text" title="hackakay"></a> <a href="http://hackaday.com/2016/09/09/landscape-lighting-that-also-texts/">Thanks HACKADAY for the BLOG Entry</a></p>

<h1>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features:</h1>

<ol>
<li>Automatically Turns on Lights at Sunset using 15Amp/250v Relay</li>
<li>Turns off lights a random time 6-9 hours later</li>
<li>A Web Interface for monitoring and manual turning on and off lights</li>
<li>Detects when a Light has burnt out using MCP3008 10Bit 8 Channel ADC</li>
<li>Sends text messages when a light is out.</li>
<li>Accounts for daylight savings time</li>
</ol>

<h1>
<a id="latest-updates" class="anchor" href="#latest-updates" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Latest Updates:</h1>

<p>15 Oct 2016: The calibrate button on the web page is now functional.    </p>

<h1>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Description:</h1>

<p>Have you ever went outside and noticed one or maybe all your lawn lights were burnt out?   This happened to me a little while ago.  I went outside at night and noticed all 12 of my lawnscape lights were burnt out.  Instead of being better at inspecting my yard at night,  I decided there had to be a better way and a perfect project for the Raspberry Pi.   This Raspberry Pi project is a simple solution that will ensure you have complete control of your lights, even when you aren't around.  Try this simple but powerful internet of things project using the Raspberry pi.        </p>

<p>The Rasberry pi will control all the turn on and off of lights and will continually monitor the system power to determine if a light is not working.  On the event a light is not working or burnt out, a text message will be sent to the phone number of your choice telling you of the problem.</p>

<p>Through a simple web application, you can remotely monitor the status and control the turn on and off of the system.  Otherwise, the Raspberry pi will turn on your lights exactly at sunset each night and will turn them off a random time between 6 and 9 hours later.    </p>

<h1>
<a id="web-application" class="anchor" href="#web-application" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Web Application:</h1>

<p>The web application, hosted by the Raspberry Pi, gives a status of the system.   The Lights On button is used to turn on and off the lights.  Text box messages tell when the lights will be turned on and off next.  there is a current monitor that shows the current being used the lawn lights. A calibrate button will be used to calibrate the system at anytime.  The sysetm will automatically calibrate when powered up for the first time.   On this setup, it will detect if a 9Watt or larger Lawn Light has is burned out.  Simple adjustments can be done to customize it to your system. </p>

<p><img src="https://github.com/drkmsmithjr/LConnect/blob/master/webpage_shot.png" alt="alt text" title="web page screen shot"></p>

<h1>
<a id="block-diagram" class="anchor" href="#block-diagram" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Block Diagram</h1>

<p><img src="https://github.com/drkmsmithjr/LConnect/blob/master/blockdiagram.png" alt="alt text" title="System Block Diagram"></p>

<h2>
<a id="current-senor-board" class="anchor" href="#current-senor-board" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Current Senor Board</h2>

<p>The current sensor board will monitor the AC primary of the Lawn Light system.   A current transformer monitors the signal and converts the signal into a low voltage AC wave that the MCP3008 10Bit ADC can read.    The ADC reads the AC signal many times to find the peak value.  This peak value represents the power in the system.   </p>

<h2>
<a id="relay-board" class="anchor" href="#relay-board" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Relay Board</h2>

<p>The HOT AC Wire of the Lawn Lights is controled by a 15A, 250v relay.  the Raspberry Pi GPIO signals then connects to the relay board control inputs to control the individual relays.  CAUTION. EXTREME CARE MUST BE TAKEN WORKING WITH PRIMARY AC SIGNALS.  TOUCHING THESE LINES WITHOUT PROPER PRECAUTION CAN KILL.  IF YOU HAVE ANY DOUBT, DON'T DO IT.  ALWAYS CHECKOUT OPERATION OF THE RELAY FIRST WITHOUT AC POWER BEFORE TRYING FULL POWER.</p>

<h2>
<a id="rpi-power-supply" class="anchor" href="#rpi-power-supply" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RPi Power Supply</h2>

<p>A 2 Amp power supply is recommended.  This power supply is always on and provides power to the Rasberry Pi and all the other LawnConnect Control circuitry.</p>

<h2>
<a id="raspberry-pi" class="anchor" href="#raspberry-pi" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Raspberry Pi</h2>

<p>A model B+ is used.   This Raspberry Pi needs to be setup with Raspbian distribution and to auto connect to the wifi system.    </p>

<h1>
<a id="wiring-diagram" class="anchor" href="#wiring-diagram" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Wiring Diagram:</h1>

<p>This is how the Raspberry Pi is connected to the sensor board schematic and the relay board
<img src="https://github.com/drkmsmithjr/LConnect/blob/master/WiringDiagram.png" alt="alt text" title="wiring diagram"></p>

<h1>
<a id="bom" class="anchor" href="#bom" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>BOM:</h1>

<p>The major components for the project are listed below
<img src="https://github.com/drkmsmithjr/LConnect/blob/master/BOM.png" alt="alt text" title="BOM"></p>

<h1>
<a id="sensor-board-schematic" class="anchor" href="#sensor-board-schematic" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sensor Board Schematic</h1>

<p>The current sensor board connects the secondary of the current transformer to an analog to digital converter (ADC).    The ADC converts the current into a digital signal that can be sampled by the Raspberry Pi</p>

<p><img src="https://github.com/drkmsmithjr/LConnect/blob/master/LawnConnect-CurrentSensor.png" alt="alt text" title="Current Sensor"></p>

<p>This simple schematic accurately reads the current of the lawn lights, protects against extreme conditions, and uses the signal processing capability of the raspberry pi to minimize components.  The heart of the circuit is the 2500 to 1 turns ratio current transformer that samples the primary current with a secondary current that is 1/2500th the primary current value.  The secondary current is converted into a voltage by the 470 ohm resistor (R1).  Different values of R1 will provide different system gains in reading the primary current.  Smaller values will provide less voltage.  Resistors over 470ohm are not recommended as they may degrade the 1% current transforer accuracy rating.  R1 was chosen in this case to accurately read currents up to 5amps RMS (approximately 600Watts of power from 120VAC outlet).  The two diodes, D1 and D2, will protect the ADC from extreme current surges.  They clamp the current to the 3.3v power supply or to the circuit ground and ensure the MCP3008 inputs don't get over their absolute maximum values.  Channel 0 and Channel 1 of the MCP3008 ADC, connected to each end of R1, are used to convert the voltage into a digital signal and transmit it to the Raspberry pi via an SPI interface.  The R1 voltage read by the ADC is a sinusoidal voltage.   It could have been converted into a rectified signal before being read, but this would take additional parts and reduce accuracy.    So instead, the Raspberry Pi is used to obtain the RMS current from this sinusoidal signal.   The Raspberry pi simply takes 100 consequtive readings to find the peak of the AC signal.   We adjusted the number of reading to ensure we were sampling the complete 60Hz sinusoidal signal.  The 10 bit ADC peak to peak sinusoidal readings are equally spaced across 3.3v, so the volts/bit = ADC READING times (3.3v/1024).   Since this is the voltage being read across the 470 ohm resistor, the current reading is obtained by dividing by this resistance (470ohms).  This represents the peak current on the secondary.  You have to multiply this by the current transformer turns ratio (2500:1) to obtain the current on the primary. Multiply this by 0.707 to obtain RMS current.  The result is RMS CURRENT = ADC_READING times (3.3v/1024/470(2500)(.707)).  Using the power of the Raspberry pi, this schematic monitors the peak and RMS currents of the lawn lights without a lot of addition components.</p>

<p>For outside low voltage halogen lighting, where the reactance of the system is minimal, this RMS current can be multiplied by AC voltage (i.e. 120volts) to obtan the power being consumed.    </p>

<h1>
<a id="software" class="anchor" href="#software" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Software</h1>

<p>The software uses a python program to monitor the current through a SPI interface and the relays through simple GPIO pins.   The simple python web server, (i.e. <code>python -m CGIHTTPServer 8010</code>) is used to service web requests.  The client webpage uses javascript to monitor user inputs and output data from the monitor program.   Communication between the web server and the main program is performed by datafiles. </p>

<p>The setup is straighforward.  You need to setup the Rasbperry Pi to automatically connect to your wifi system.  Then you also need to be able to access the Raspberry pi as a headless system.   There are plenty of guides available on the internet.  The key is that you can log into the system via <code>ssh pi@xxx.xxx.1.xxx</code> where <code>xxx.xxx.1.xxx</code> is the IP address of your Raspberry Pi.  </p>

<p>Download the github software into the <code>/home/pi</code> directory.  </p>

<pre><code>git clone https://github.com/drkmsmithjr/LConnect.git
</code></pre>

<p>Edit and setup the crontab to automatically start the boot.sh script.</p>

<pre><code>crontab -e
</code></pre>

<p>edit this file with the following command</p>

<pre><code>@reboot  /home/pi/LConnect/boot.sh
</code></pre>

<p>Reboot the system to get things started.</p>

<pre><code>sudo reboot
</code></pre>

<p>Open a browser and find the IP address of the Raspberry Pi to access the webpage.   You need the :8010 port extension to access the browser</p>

<pre><code>RPIADDRESS:8010/LawnConnectIndex.html
</code></pre>

<h2>
<a id="setting-up-the-correct-gps-location" class="anchor" href="#setting-up-the-correct-gps-location" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting up the Correct GPS Location</h2>

<p>You will need to put your Longitude and Latitude into the <code>LawnConnect.py</code> code by setting the <code>o.lat</code> and <code>o.long</code> parameters</p>

<pre><code>    o.lat = '33.4672'
    o.long = '-117.6981'
</code></pre>

<h2>
<a id="twillo-account-setup" class="anchor" href="#twillo-account-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Twillo Account Setup</h2>

<p>The LawnConnect will sent an SMS message to your cell phone using Twillo Account.   You will need to get a Free Twillo Account at <code>https://www.twilio.com</code>.   After getting an account, get the twillo Phone Number, Account Number, and Token and place them into the twilloaccount.py file.  this file is not in the Git download but can easily be generated as follows:</p>

<pre><code>#!/usr/bin/python
# where to put the twillo account information
Taccount= 'twillo_account'
Ttoken ='twillo_token'
Tnumber = 'twillo number'
To_number = 'Number to Call'
</code></pre>

<p>save this <code>twilloaccount.py</code> file into the <code>/home/pi/LConnect</code> directory</p>

<p>When the LawnConnect detects when one or more lights are out, a text will be sent to the number you choose.  It will repeat this text each night until you replace the light or a new calibration is performed either by pressing the calibration button on the webpage or by restarting the software.  Here is an example text to an iphone:</p>

<p><img src="https://github.com/drkmsmithjr/LConnect/blob/master/twillo_image.png" alt="alt text" title="Twillo Text"></p>

<h1>
<a id="web-software" class="anchor" href="#web-software" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Web Software</h1>

<h2>
<a id="calibrate-button" class="anchor" href="#calibrate-button" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calibrate Button</h2>

<p>The Calibrate button, when pushed, will set the reading of the light current and store this value for comparison.  A future reading below this baseline value will indicate that a light has burnt out and will send a text message indicating the event.<br>
You are all set.  Good Luck and let me know if you have any questions.</p>

<p>The webpage for the project is located at <a href="https://drkmsmithjr.github.io/LConnect">https://drkmsmithjr.github.io/LConnect</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/drkmsmithjr/LConnect">Lconnect</a> is maintained by <a href="https://github.com/drkmsmithjr">drkmsmithjr</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
